generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Admin {
  id                  Int                  @id @default(autoincrement())
  username            String               @unique
  email               String               @unique
  password            String
  name                String
  role                String               @default("AGENT")
  active              Boolean              @default(true)
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  activities          AdminActivity[]
  properties          Property[]
  propertySubmissions PropertySubmission[]

  @@map("admins")
}

model Property {
  id               Int             @id @default(autoincrement())
  name             String
  price            Float
  zone             String?
  comfort          String?
  street           String?
  latitude         Float?
  longitude        Float?
  surface          Float
  registrationDate DateTime        @default(now())
  ownerCnp         String?
  rooms            Int?
  floor            Int?
  totalFloors      Int?
  position         String?
  locality         String
  operationType    String
  propertyType     String
  description      String?
  features         String?
  status           String          @default("ACTIVE")
  featured         Boolean         @default(false)
  views            Int             @default(0)
  adminId          Int
  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @updatedAt
  archivedAt       DateTime?
  heating          String?
  condition        String?
  availableFrom    String?
  deposit          String?
  buildingType     String?
  buildingMaterial String?
  yearBuilt        Int?
  currency         String          @default("RON")
  inquiries        ClientInquiry[]
  admin            Admin           @relation(fields: [adminId], references: [id])
  images           PropertyImage[]

  @@map("properties")
}

model PropertyImage {
  id         Int      @id @default(autoincrement())
  url        String
  alt        String?
  isPrimary  Boolean  @default(false)
  order      Int      @default(0)
  propertyId Int
  createdAt  DateTime @default(now())
  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@map("property_images")
}

model Agent {
  id        Int      @id @default(autoincrement())
  firstName String
  lastName  String
  phone     String   @unique
  email     String?  @unique
  zone      String
  avatar    String?
  active    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("agents")
}

model ClientInquiry {
  id              Int       @id @default(autoincrement())
  name            String
  email           String
  phone           String?
  transactionType String
  propertyType    String?
  price           Float?
  locality        String?
  zone            String?
  address         String?
  rooms           Int?
  surface         Float?
  message         String
  status          String    @default("NEW")
  propertyId      Int?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  property        Property? @relation(fields: [propertyId], references: [id])

  @@map("client_inquiries")
}

model ExchangeRate {
  id        Int      @id @default(autoincrement())
  date      DateTime @unique
  eurRate   Float
  usdRate   Float
  createdAt DateTime @default(now())

  @@map("exchange_rates")
}

model AdminActivity {
  id          Int      @id @default(autoincrement())
  adminId     Int
  action      String
  resource    String
  resourceId  Int?
  description String
  createdAt   DateTime @default(now())
  admin       Admin    @relation(fields: [adminId], references: [id])

  @@map("admin_activities")
}

model PropertySubmission {
  id             Int       @id @default(autoincrement())
  ownerName      String
  phone          String
  email          String
  propertyType   String
  operationType  String
  locality       String
  zone           String
  address        String
  surface        Float
  rooms          Int?
  floor          Int?
  totalFloors    Int?
  estimatedPrice Float
  description    String
  features       String?
  images         String?
  status         String    @default("NEW")
  assignedToId   Int?
  notes          String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  contactedAt    DateTime?
  assignedTo     Admin?    @relation(fields: [assignedToId], references: [id])

  @@map("property_submissions")
}
